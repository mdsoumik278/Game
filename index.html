<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS: Styling the game */
        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at center, #2b5c7c 0%, #4e4376 100%);
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
            -webkit-user-select: none;
        }

        .game-area {
            width: 400px;
            height: 100vh;
            background-color: #2c3e50;
            background-image:
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
            overflow: hidden;
            border-left: 8px dashed rgba(255, 255, 255, 0.8);
            border-right: 8px dashed rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
        }

        .line {
            width: 10px;
            height: 100px;
            background: rgba(255, 255, 255, 0.8);
            position: absolute;
            left: 195px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .car,
        .enemy {
            width: 50px;
            height: 90px;
            position: absolute;
            border-radius: 12px;
            box-shadow:
                0 10px 20px rgba(0, 0, 0, 0.6),
                inset 3px 0 5px rgba(255, 255, 255, 0.2),
                inset -3px 0 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .car {
            background: #e74c3c;
            bottom: 100px;
            left: 175px;
        }

        .enemy {
            background: #f1c40f;
            z-index: 9;
        }

        /* Car Details (Windshield, Roof, Lights) */
        .car::before,
        .enemy::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 5px;
            width: 40px;
            height: 20px;
            background: linear-gradient(180deg, #333 0%, #111 100%);
            border-radius: 4px 4px 8px 8px;
            box-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .car::after,
        .enemy::after {
            content: '';
            position: absolute;
            bottom: 12px;
            left: 5px;
            width: 40px;
            height: 12px;
            background: linear-gradient(180deg, #333 0%, #111 100%);
            border-radius: 8px 8px 4px 4px;
        }

        /* Headlights & Taillights */
        /* Headlights glow for Player Car */
        .car {
            box-shadow:
                0 -5px 20px rgba(255, 255, 200, 0.6),
                /* Headlights glow */
                0 10px 20px rgba(0, 0, 0, 0.6),
                /* Drop shadow */
                inset 3px 0 5px rgba(255, 255, 255, 0.2),
                /* 3D Side Light */
                inset -3px 0 5px rgba(0, 0, 0, 0.2);
            /* 3D Side shadow */
        }

        .score-board {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #fff;
            padding: 10px 25px;
            font-size: 20px;
            border-radius: 30px;
            z-index: 20;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .start-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.6);
            font-size: 1.2em;
            line-height: 1.6;
        }

        .start-screen:hover {
            box-shadow: 0 0 50px rgba(231, 76, 60, 1);
        }

        /* --- CONTROLS (BOTTOM) --- */
        .controls {
            position: absolute;
            bottom: 100px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            z-index: 100;
            pointer-events: none;
        }

        .control-btn {
            width: 90px;
            height: 90px;
            background: rgb(230, 80, 80);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 45%;
            color: white;
            font-size: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active,
        .control-btn.active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* --- MUSIC CONTROLS --- */
        .music-controls {
            position: absolute;
            top: 80px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
        }

        input[type=range] {
            accent-color: #e74c3c;
        }

        /* --- TOP CONTROLS (PAUSE & RESTART) --- */
        .top-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .top-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .top-btn:hover {
            background: #e74c3c;
            border-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
    </style>
</head>

<body>

    <div class="game-area">
        <div class="score-board">Score: <span id="score">0</span></div>

        <!-- ! MUSIC CONTROLS -->
        <div class="music-controls">
            <button class="top-btn" id="musicBtn" onclick="toggleMusic()">üéµ</button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5">
        </div>
        <audio id="bgMusic" loop>
            <source src="bootleg-remix-slowed-and-reverb.mp3" type="audio/mpeg">
        </audio>

        <!-- ! TOP BUTTONS -->
        <div class="top-controls">
            <button class="top-btn" id="pauseBtn" onclick="togglePause()">‚è∏</button>
            <button class="top-btn" onclick="resetGame()">‚Üª</button>
        </div>

        <div class="start-screen" onclick="start()">
            <p>Click here to start <br> Arrow keys or Buttons to Move</p>
        </div>

        <!-- ! BOTTOM BUTTONS -->
        <div class="controls">
            <div class="control-btn" id="btnLeft">‚Üê</div>
            <div class="control-btn" id="btnRight">‚Üí</div>
        </div>
    </div>

    <script>
        const scoreObj = document.getElementById('score');
        const musicBtn = document.getElementById('musicBtn');
        const bgMusic = document.getElementById('bgMusic');
        const volumeSlider = document.getElementById('volumeSlider');
        const startScreen = document.querySelector('.start-screen');
        const gameArea = document.querySelector('.game-area');
        const pauseBtn = document.getElementById('pauseBtn');

        const btnLeft = document.getElementById('btnLeft');
        const btnRight = document.getElementById('btnRight');

        let player = { speed: 5, score: 0, start: false };
        let keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
        let isPaused = false;

        // --- INPUT LISTENERS ---
        document.addEventListener('keydown', keyDown);
        document.addEventListener('keyup', keyUp);

        function keyDown(e) {
            e.preventDefault();
            keys[e.key] = true;
        }
        function keyUp(e) {
            e.preventDefault();
            keys[e.key] = false;
        }

        function pressKey(key, state) { keys[key] = state; }

        // Touch/Mouse Controls for Movement
        [btnLeft, btnRight].forEach(btn => {
            let key = btn.id === 'btnLeft' ? 'ArrowLeft' : 'ArrowRight';

            btn.addEventListener('mousedown', () => pressKey(key, true));
            btn.addEventListener('mouseup', () => pressKey(key, false));
            btn.addEventListener('mouseleave', () => pressKey(key, false));

            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                pressKey(key, true);
                btn.classList.add('active');
            });
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                pressKey(key, false);
                btn.classList.remove('active');
            });
        });

        // --- MUSIC LOGIC ---
        bgMusic.volume = 0.5;

        function toggleMusic() {
            if (bgMusic.paused) {
                bgMusic.play();
                musicBtn.innerHTML = "üîä";
            } else {
                bgMusic.pause();
                musicBtn.innerHTML = "üéµ";
            }
        }

        volumeSlider.addEventListener('input', (e) => {
            bgMusic.volume = e.target.value;
        });

        // --- GAME LOGIC ---

        function isCollide(a, b) {
            aRect = a.getBoundingClientRect();
            bRect = b.getBoundingClientRect();
            return !((aRect.bottom < bRect.top) || (aRect.top > bRect.bottom) || (aRect.right < bRect.left) || (aRect.left > bRect.right));
        }

        function moveLines() {
            let lines = document.querySelectorAll('.line');
            lines.forEach(function (item) {
                if (item.y >= 700) { item.y -= 750; }
                item.y += player.speed;
                item.style.top = item.y + "px";
            });
        }

        function endGame() {
            player.start = false;
            startScreen.innerHTML = "Game Over <br> Score: " + player.score + "<br> Click to Restart";
            startScreen.style.display = "block";
        }

        function moveEnemy(car) {
            let enemies = document.querySelectorAll('.enemy');
            enemies.forEach(function (item) {
                if (isCollide(car, item)) {
                    endGame();
                }
                if (item.y >= 750) {
                    item.y = -300;
                    item.style.left = Math.floor(Math.random() * 350) + "px";
                }
                item.y += player.speed;
                item.style.top = item.y + "px";
            });
        }

        // --- PAUSE & RESET FUNCTIONS ---

        function togglePause() {
            if (!player.start) return; // Cannot pause if game hasn't started
            isPaused = !isPaused;
            if (isPaused) {
                pauseBtn.innerHTML = "‚ñ∂"; // Play icon
                startScreen.innerHTML = "Paused <br> Click Play button to resume";
                startScreen.style.display = "block";
                startScreen.onclick = null; // Disable clicking screen to resume, must use button
            } else {
                pauseBtn.innerHTML = "‚è∏"; // Pause icon
                startScreen.style.display = "none";
                startScreen.onclick = start; // Restore start click
                window.requestAnimationFrame(gamePlay);
            }
        }

        function resetGame() {
            // Force end existing game loop
            player.start = false;
            isPaused = false;
            pauseBtn.innerHTML = "‚è∏";

            // Clean up old elements
            document.querySelectorAll('.line').forEach(e => e.remove());
            document.querySelectorAll('.car').forEach(e => e.remove());
            document.querySelectorAll('.enemy').forEach(e => e.remove());

            // Immediately restart
            start();
        }

        function gamePlay() {
            let car = document.querySelector('.car');
            let road = gameArea.getBoundingClientRect();

            if (player.start) {
                if (isPaused) return; // Stop logic if paused

                moveLines();
                moveEnemy(car);

                if (keys.ArrowUp && player.y > (road.top + 70)) { player.y -= player.speed; }
                if (keys.ArrowDown && player.y < (road.bottom - 85)) { player.y += player.speed; }
                if (keys.ArrowLeft && player.x > 0) { player.x -= player.speed; }
                if (keys.ArrowRight && player.x < (road.width - 50)) { player.x += player.speed; }

                car.style.top = player.y + "px";
                car.style.left = player.x + "px";

                window.requestAnimationFrame(gamePlay);
                player.score++;
                scoreObj.innerText = player.score - 1;
            }
        }

        function start() {
            // Reset state
            startScreen.style.display = "none";
            startScreen.onclick = start;
            isPaused = false;
            pauseBtn.innerHTML = "‚è∏";

            // Clear only game objects (Keep buttons)
            document.querySelectorAll('.line').forEach(e => e.remove());
            document.querySelectorAll('.car').forEach(e => e.remove());
            document.querySelectorAll('.enemy').forEach(e => e.remove());

            player.start = true;
            player.score = 0;
            window.requestAnimationFrame(gamePlay);

            // Create Road Lines
            for (let x = 0; x < 5; x++) {
                let roadLine = document.createElement('div');
                roadLine.setAttribute('class', 'line');
                roadLine.y = (x * 150);
                roadLine.style.top = roadLine.y + "px";
                gameArea.appendChild(roadLine);
            }

            // Create Player Car
            let car = document.createElement('div');
            car.setAttribute('class', 'car');
            gameArea.appendChild(car);

            player.x = car.offsetLeft;
            player.y = car.offsetTop;

            // Create Enemy Cars
            for (let x = 0; x < 3; x++) {
                let enemyCar = document.createElement('div');
                enemyCar.setAttribute('class', 'enemy');
                enemyCar.y = ((x + 1) * 350) * -1;
                enemyCar.style.top = enemyCar.y + "px";
                enemyCar.style.backgroundColor = randomColor();
                enemyCar.style.left = Math.floor(Math.random() * 350) + "px";
                gameArea.appendChild(enemyCar);
            }
        }

        function randomColor() {
            function c() {
                let hex = Math.floor(Math.random() * 256).toString(16);
                return ("0" + String(hex)).substr(-2);
            }
            return "#" + c() + c() + c();
        }

    </script>
</body>

</html>